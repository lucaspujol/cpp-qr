#pragma once

#include <cstdint>

/**
 * Maximum number of characters that can be encoded for a given
 * QR version, error correction level, and encoding mode.
 *
 * Indices:
 *   [version 0-39]  (version 1 = index 0, version 40 = index 39)
 *   [EC level]      0=L, 1=M, 2=Q, 3=H
 *   [mode]          0=Numeric, 1=Alphanumeric, 2=Byte
 *
 * Example: CHAR_CAPACITIES[0][2][1] = 16
 *   -> Version 1, EC level Q, Alphanumeric mode can hold 16 characters.
 *
 * Source: https://www.thonky.com/qr-code-tutorial/character-capacities
 */
constexpr uint16_t CHAR_CAPACITIES[40][4][3] = {
    // Version 1
    {
        { 41, 25, 17 }, // L
        { 34, 20, 14 }, // M
        { 27, 16, 11 }, // Q
        { 17, 10, 7 },  // H
    },
    // Version 2
    {
        { 77, 47, 32 }, // L
        { 63, 38, 26 }, // M
        { 48, 29, 20 }, // Q
        { 34, 20, 14 }, // H
    },
    // Version 3
    {
        { 127, 77, 53 }, // L
        { 101, 61, 42 }, // M
        { 77, 47, 32 },  // Q
        { 58, 35, 24 },  // H
    },
    // Version 4
    {
        { 187, 114, 78 }, // L
        { 149, 90, 62 },  // M
        { 111, 67, 46 },  // Q
        { 82, 50, 34 },   // H
    },
    // Version 5
    {
        { 255, 154, 106 }, // L
        { 202, 122, 84 },  // M
        { 144, 87, 60 },   // Q
        { 106, 64, 44 },   // H
    },
    // Version 6
    {
        { 322, 195, 134 }, // L
        { 255, 154, 106 }, // M
        { 178, 108, 74 },  // Q
        { 139, 84, 58 },   // H
    },
    // Version 7
    {
        { 370, 224, 154 }, // L
        { 293, 178, 122 }, // M
        { 207, 125, 86 },  // Q
        { 154, 93, 64 },   // H
    },
    // Version 8
    {
        { 461, 279, 192 }, // L
        { 365, 221, 152 }, // M
        { 259, 157, 108 }, // Q
        { 202, 122, 84 },  // H
    },
    // Version 9
    {
        { 552, 335, 230 }, // L
        { 432, 262, 180 }, // M
        { 312, 189, 130 }, // Q
        { 235, 143, 98 },  // H
    },
    // Version 10
    {
        { 652, 395, 271 }, // L
        { 513, 311, 213 }, // M
        { 364, 221, 151 }, // Q
        { 288, 174, 119 }, // H
    },
    // Version 11
    {
        { 772, 468, 321 }, // L
        { 604, 366, 251 }, // M
        { 427, 259, 177 }, // Q
        { 331, 200, 137 }, // H
    },
    // Version 12
    {
        { 883, 535, 367 }, // L
        { 691, 419, 287 }, // M
        { 489, 296, 203 }, // Q
        { 374, 227, 155 }, // H
    },
    // Version 13
    {
        { 1022, 619, 425 }, // L
        { 796, 483, 331 },  // M
        { 580, 352, 241 },  // Q
        { 427, 259, 177 },  // H
    },
    // Version 14
    {
        { 1101, 667, 458 }, // L
        { 871, 528, 362 },  // M
        { 621, 376, 258 },  // Q
        { 468, 283, 194 },  // H
    },
    // Version 15
    {
        { 1250, 758, 520 }, // L
        { 991, 600, 412 },  // M
        { 703, 426, 292 },  // Q
        { 530, 321, 220 },  // H
    },
    // Version 16
    {
        { 1408, 854, 586 }, // L
        { 1082, 656, 450 }, // M
        { 775, 470, 322 },  // Q
        { 602, 365, 250 },  // H
    },
    // Version 17
    {
        { 1548, 938, 644 }, // L
        { 1212, 734, 504 }, // M
        { 876, 531, 364 },  // Q
        { 674, 408, 280 },  // H
    },
    // Version 18
    {
        { 1725, 1046, 718 }, // L
        { 1346, 816, 560 },  // M
        { 948, 574, 394 },   // Q
        { 746, 452, 310 },   // H
    },
    // Version 19
    {
        { 1903, 1153, 792 }, // L
        { 1500, 909, 624 },  // M
        { 1063, 644, 442 },  // Q
        { 813, 493, 338 },   // H
    },
    // Version 20
    {
        { 2061, 1249, 858 }, // L
        { 1600, 970, 666 },  // M
        { 1159, 702, 482 },  // Q
        { 919, 557, 382 },   // H
    },
    // Version 21
    {
        { 2232, 1352, 929 }, // L
        { 1708, 1035, 711 }, // M
        { 1224, 742, 509 },  // Q
        { 969, 587, 403 },   // H
    },
    // Version 22
    {
        { 2409, 1460, 1003 }, // L
        { 1872, 1134, 779 },  // M
        { 1358, 823, 565 },   // Q
        { 1056, 640, 439 },   // H
    },
    // Version 23
    {
        { 2620, 1588, 1091 }, // L
        { 2059, 1248, 857 },  // M
        { 1468, 890, 611 },   // Q
        { 1108, 672, 461 },   // H
    },
    // Version 24
    {
        { 2812, 1704, 1171 }, // L
        { 2188, 1326, 911 },  // M
        { 1588, 963, 661 },   // Q
        { 1228, 744, 511 },   // H
    },
    // Version 25
    {
        { 3057, 1853, 1273 }, // L
        { 2395, 1451, 997 },  // M
        { 1718, 1041, 715 },  // Q
        { 1286, 779, 535 },   // H
    },
    // Version 26
    {
        { 3283, 1990, 1367 }, // L
        { 2544, 1542, 1059 }, // M
        { 1804, 1094, 751 },  // Q
        { 1425, 864, 593 },   // H
    },
    // Version 27
    {
        { 3517, 2132, 1465 }, // L
        { 2701, 1637, 1125 }, // M
        { 1933, 1172, 805 },  // Q
        { 1501, 910, 625 },   // H
    },
    // Version 28
    {
        { 3669, 2223, 1528 }, // L
        { 2857, 1732, 1190 }, // M
        { 2085, 1263, 868 },  // Q
        { 1581, 958, 658 },   // H
    },
    // Version 29
    {
        { 3909, 2369, 1628 }, // L
        { 3035, 1839, 1264 }, // M
        { 2181, 1322, 908 },  // Q
        { 1677, 1016, 698 },  // H
    },
    // Version 30
    {
        { 4158, 2520, 1732 }, // L
        { 3289, 1994, 1370 }, // M
        { 2358, 1429, 982 },  // Q
        { 1782, 1080, 742 },  // H
    },
    // Version 31
    {
        { 4417, 2677, 1840 }, // L
        { 3486, 2113, 1452 }, // M
        { 2473, 1499, 1030 }, // Q
        { 1897, 1150, 790 },  // H
    },
    // Version 32
    {
        { 4686, 2840, 1952 }, // L
        { 3693, 2238, 1538 }, // M
        { 2670, 1618, 1112 }, // Q
        { 2022, 1226, 842 },  // H
    },
    // Version 33
    {
        { 4965, 3009, 2068 }, // L
        { 3909, 2369, 1628 }, // M
        { 2805, 1700, 1168 }, // Q
        { 2157, 1307, 898 },  // H
    },
    // Version 34
    {
        { 5253, 3183, 2188 }, // L
        { 4134, 2506, 1722 }, // M
        { 2949, 1787, 1228 }, // Q
        { 2301, 1394, 958 },  // H
    },
    // Version 35
    {
        { 5529, 3351, 2303 }, // L
        { 4343, 2632, 1809 }, // M
        { 3081, 1867, 1283 }, // Q
        { 2361, 1431, 983 },  // H
    },
    // Version 36
    {
        { 5836, 3537, 2431 }, // L
        { 4588, 2780, 1911 }, // M
        { 3244, 1966, 1351 }, // Q
        { 2524, 1530, 1051 }, // H
    },
    // Version 37
    {
        { 6153, 3729, 2563 }, // L
        { 4775, 2894, 1989 }, // M
        { 3417, 2071, 1423 }, // Q
        { 2625, 1591, 1093 }, // H
    },
    // Version 38
    {
        { 6479, 3927, 2699 }, // L
        { 5039, 3054, 2099 }, // M
        { 3599, 2181, 1499 }, // Q
        { 2735, 1658, 1139 }, // H
    },
    // Version 39
    {
        { 6743, 4087, 2809 }, // L
        { 5313, 3220, 2213 }, // M
        { 3791, 2298, 1579 }, // Q
        { 2927, 1774, 1219 }, // H
    },
    // Version 40
    {
        { 7089, 4296, 2953 }, // L
        { 5596, 3391, 2331 }, // M
        { 3993, 2420, 1663 }, // Q
        { 3057, 1852, 1273 }, // H
    }};

/**
 * Error correction block structure for a given version/EC level.
 *
 * Data codewords are split into groups of blocks for error correction.
 * Some versions use only one group, others split into two groups
 * where group 2 blocks each hold one more data codeword than group 1.
 *
 * Example for version 5-Q: { 62, 18, 2, 15, 2, 16 }
 *   -> 62 total data codewords, 18 EC codewords generated per block,
 *      group 1 has 2 blocks of 15 data codewords each,
 *      group 2 has 2 blocks of 16 data codewords each.
 *      Total: (15*2) + (16*2) = 62
 *      Each of the 4 blocks produces 18 EC codewords.
 *
 * When group2_blocks is 0, all blocks are in group 1.
 */
struct ECBlockInfo
{
    uint16_t total_data_codewords;    // Total data codewords (bytes) for this version/EC
    uint8_t ec_codewords_per_block;   // Number of EC codewords generated per block
    uint8_t group1_blocks;            // Number of blocks in group 1
    uint8_t group1_data_codewords;    // Data codewords in each group 1 block
    uint8_t group2_blocks;            // Number of blocks in group 2 (0 if none)
    uint8_t group2_data_codewords;    // Data codewords in each group 2 block (0 if none)
};

/**
 * Error correction block info per version and EC level.
 *
 * Indices:
 *   [version 0-39]  (version 1 = index 0, version 40 = index 39)
 *   [EC level]      0=L, 1=M, 2=Q, 3=H
 *
 * Source: https://www.thonky.com/qr-code-tutorial/error-correction-table
 */
constexpr ECBlockInfo EC_TABLE[40][4] = {
    // Version 1
    {
        { 19, 7, 1, 19, 0, 0 },  // L
        { 16, 10, 1, 16, 0, 0 }, // M
        { 13, 13, 1, 13, 0, 0 }, // Q
        { 9, 17, 1, 9, 0, 0 },   // H
    },
    // Version 2
    {
        { 34, 10, 1, 34, 0, 0 }, // L
        { 28, 16, 1, 28, 0, 0 }, // M
        { 22, 22, 1, 22, 0, 0 }, // Q
        { 16, 28, 1, 16, 0, 0 }, // H
    },
    // Version 3
    {
        { 55, 15, 1, 55, 0, 0 }, // L
        { 44, 26, 1, 44, 0, 0 }, // M
        { 34, 18, 2, 17, 0, 0 }, // Q
        { 26, 22, 2, 13, 0, 0 }, // H
    },
    // Version 4
    {
        { 80, 20, 1, 80, 0, 0 }, // L
        { 64, 18, 2, 32, 0, 0 }, // M
        { 48, 26, 2, 24, 0, 0 }, // Q
        { 36, 16, 4, 9, 0, 0 },  // H
    },
    // Version 5
    {
        { 108, 26, 1, 108, 0, 0 }, // L
        { 86, 24, 2, 43, 0, 0 },   // M
        { 62, 18, 2, 15, 2, 16 },  // Q
        { 46, 22, 2, 11, 2, 12 },  // H
    },
    // Version 6
    {
        { 136, 18, 2, 68, 0, 0 }, // L
        { 108, 16, 4, 27, 0, 0 }, // M
        { 76, 24, 4, 19, 0, 0 },  // Q
        { 60, 28, 4, 15, 0, 0 },  // H
    },
    // Version 7
    {
        { 156, 20, 2, 78, 0, 0 }, // L
        { 124, 18, 4, 31, 0, 0 }, // M
        { 88, 18, 2, 14, 4, 15 }, // Q
        { 66, 26, 4, 13, 1, 14 }, // H
    },
    // Version 8
    {
        { 194, 24, 2, 97, 0, 0 },  // L
        { 154, 22, 2, 38, 2, 39 }, // M
        { 110, 22, 4, 18, 2, 19 }, // Q
        { 86, 26, 4, 14, 2, 15 },  // H
    },
    // Version 9
    {
        { 232, 30, 2, 116, 0, 0 }, // L
        { 182, 22, 3, 36, 2, 37 }, // M
        { 132, 20, 4, 16, 4, 17 }, // Q
        { 100, 24, 4, 12, 4, 13 }, // H
    },
    // Version 10
    {
        { 274, 18, 2, 68, 2, 69 }, // L
        { 216, 26, 4, 43, 1, 44 }, // M
        { 154, 24, 6, 19, 2, 20 }, // Q
        { 122, 28, 6, 15, 2, 16 }, // H
    },
    // Version 11
    {
        { 324, 20, 4, 81, 0, 0 },  // L
        { 254, 30, 1, 50, 4, 51 }, // M
        { 180, 28, 4, 22, 4, 23 }, // Q
        { 140, 24, 3, 12, 8, 13 }, // H
    },
    // Version 12
    {
        { 370, 24, 2, 92, 2, 93 }, // L
        { 290, 22, 6, 36, 2, 37 }, // M
        { 206, 26, 4, 20, 6, 21 }, // Q
        { 158, 28, 7, 14, 4, 15 }, // H
    },
    // Version 13
    {
        { 428, 26, 4, 107, 0, 0 }, // L
        { 334, 22, 8, 37, 1, 38 }, // M
        { 244, 24, 8, 20, 4, 21 }, // Q
        { 180, 22, 12, 11, 4, 12},// H
    },
    // Version 14
    {
        { 461, 30, 3, 115, 1, 116 }, // L
        { 365, 24, 4, 40, 5, 41 },   // M
        { 261, 20, 11, 16, 5, 17 },  // Q
        { 197, 24, 11, 12, 5, 13 },  // H
    },
    // Version 15
    {
        { 523, 22, 5, 87, 1, 88 }, // L
        { 415, 24, 5, 41, 5, 42 }, // M
        { 295, 30, 5, 24, 7, 25 }, // Q
        { 223, 24, 11, 12, 7, 13},// H
    },
    // Version 16
    {
        { 589, 24, 5, 98, 1, 99 },  // L
        { 453, 28, 7, 45, 3, 46 },  // M
        { 325, 24, 15, 19, 2, 20 }, // Q
        { 253, 30, 3, 15, 13, 16 }, // H
    },
    // Version 17
    {
        { 647, 28, 1, 107, 5, 108 }, // L
        { 507, 28, 10, 46, 1, 47 },  // M
        { 367, 28, 1, 22, 15, 23 },  // Q
        { 283, 28, 2, 14, 17, 15 },  // H
    },
    // Version 18
    {
        { 721, 30, 5, 120, 1, 121 }, // L
        { 563, 26, 9, 43, 4, 44 },   // M
        { 397, 28, 17, 22, 1, 23 },  // Q
        { 313, 28, 2, 14, 19, 15 },  // H
    },
    // Version 19
    {
        { 795, 28, 3, 113, 4, 114 }, // L
        { 627, 26, 3, 44, 11, 45 },  // M
        { 445, 26, 17, 21, 4, 22 },  // Q
        { 341, 26, 9, 13, 16, 14 },  // H
    },
    // Version 20
    {
        { 861, 28, 3, 107, 5, 108 }, // L
        { 669, 26, 3, 41, 13, 42 },  // M
        { 485, 30, 15, 24, 5, 25 },  // Q
        { 385, 28, 15, 15, 10, 16 }, // H
    },
    // Version 21
    {
        { 932, 28, 4, 116, 4, 117 }, // L
        { 714, 26, 17, 42, 0, 0 },   // M
        { 512, 28, 17, 22, 6, 23 },  // Q
        { 406, 30, 19, 16, 6, 17 },  // H
    },
    // Version 22
    {
        { 1006, 28, 2, 111, 7, 112 }, // L
        { 782, 28, 17, 46, 0, 0 },    // M
        { 568, 30, 7, 24, 16, 25 },   // Q
        { 442, 24, 34, 13, 0, 0 },    // H
    },
    // Version 23
    {
        { 1094, 30, 4, 121, 5, 122 }, // L
        { 860, 28, 4, 47, 14, 48 },   // M
        { 614, 30, 11, 24, 14, 25 },  // Q
        { 464, 30, 16, 15, 14, 16 },  // H
    },
    // Version 24
    {
        { 1174, 30, 6, 117, 4, 118 }, // L
        { 914, 28, 6, 45, 14, 46 },   // M
        { 664, 30, 11, 24, 16, 25 },  // Q
        { 514, 30, 30, 16, 2, 17 },   // H
    },
    // Version 25
    {
        { 1276, 26, 8, 106, 4, 107 }, // L
        { 1000, 28, 8, 47, 13, 48 },  // M
        { 718, 30, 7, 24, 22, 25 },   // Q
        { 538, 30, 22, 15, 13, 16 },  // H
    },
    // Version 26
    {
        { 1370, 28, 10, 114, 2, 115 }, // L
        { 1062, 28, 19, 46, 4, 47 },   // M
        { 754, 28, 28, 22, 6, 23 },    // Q
        { 596, 30, 33, 16, 4, 17 },    // H
    },
    // Version 27
    {
        { 1468, 30, 8, 122, 4, 123 }, // L
        { 1128, 28, 22, 45, 3, 46 },  // M
        { 808, 30, 8, 23, 26, 24 },   // Q
        { 628, 30, 12, 15, 28, 16 },  // H
    },
    // Version 28
    {
        { 1531, 30, 3, 117, 10, 118 }, // L
        { 1193, 28, 3, 45, 23, 46 },   // M
        { 871, 30, 4, 24, 31, 25 },    // Q
        { 661, 30, 11, 15, 31, 16 },   // H
    },
    // Version 29
    {
        { 1631, 30, 7, 116, 7, 117 }, // L
        { 1267, 28, 21, 45, 7, 46 },  // M
        { 911, 30, 1, 23, 37, 24 },   // Q
        { 701, 30, 19, 15, 26, 16 },  // H
    },
    // Version 30
    {
        { 1735, 30, 5, 115, 10, 116 }, // L
        { 1373, 28, 19, 47, 10, 48 },  // M
        { 985, 30, 15, 24, 25, 25 },   // Q
        { 745, 30, 23, 15, 25, 16 },   // H
    },
    // Version 31
    {
        { 1843, 30, 13, 115, 3, 116 }, // L
        { 1455, 28, 2, 46, 29, 47 },   // M
        { 1033, 30, 42, 24, 1, 25 },   // Q
        { 793, 30, 23, 15, 28, 16 },   // H
    },
    // Version 32
    {
        { 1955, 30, 17, 115, 0, 0 },  // L
        { 1541, 28, 10, 46, 23, 47 }, // M
        { 1115, 30, 10, 24, 35, 25 }, // Q
        { 845, 30, 19, 15, 35, 16 },  // H
    },
    // Version 33
    {
        { 2071, 30, 17, 115, 1, 116 }, // L
        { 1631, 28, 14, 46, 21, 47 },  // M
        { 1171, 30, 29, 24, 19, 25 },  // Q
        { 901, 30, 11, 15, 46, 16 },   // H
    },
    // Version 34
    {
        { 2191, 30, 13, 115, 6, 116 }, // L
        { 1725, 28, 14, 46, 23, 47 },  // M
        { 1231, 30, 44, 24, 7, 25 },   // Q
        { 961, 30, 59, 16, 1, 17 },    // H
    },
    // Version 35
    {
        { 2306, 30, 12, 121, 7, 122 }, // L
        { 1812, 28, 12, 47, 26, 48 },  // M
        { 1286, 30, 39, 24, 14, 25 },  // Q
        { 986, 30, 22, 15, 41, 16 },   // H
    },
    // Version 36
    {
        { 2434, 30, 6, 121, 14, 122 }, // L
        { 1914, 28, 6, 47, 34, 48 },   // M
        { 1354, 30, 46, 24, 10, 25 },  // Q
        { 1054, 30, 2, 15, 64, 16 },   // H
    },
    // Version 37
    {
        { 2566, 30, 17, 122, 4, 123 }, // L
        { 1992, 28, 29, 46, 14, 47 },  // M
        { 1426, 30, 49, 24, 10, 25 },  // Q
        { 1096, 30, 24, 15, 46, 16 },  // H
    },
    // Version 38
    {
        { 2702, 30, 4, 122, 18, 123 }, // L
        { 2102, 28, 13, 46, 32, 47 },  // M
        { 1502, 30, 48, 24, 14, 25 },  // Q
        { 1142, 30, 42, 15, 32, 16 },  // H
    },
    // Version 39
    {
        { 2812, 30, 20, 117, 4, 118 }, // L
        { 2216, 28, 40, 47, 7, 48 },   // M
        { 1582, 30, 43, 24, 22, 25 },  // Q
        { 1222, 30, 10, 15, 67, 16 },  // H
    },
    // Version 40
    {
        { 2956, 30, 19, 118, 6, 119 }, // L
        { 2334, 28, 18, 47, 31, 48 },  // M
        { 1666, 30, 34, 24, 34, 25 },  // Q
        { 1276, 30, 20, 15, 61, 16 },  // H
    }
};
